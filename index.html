<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Participación</title>
    <style>
        /* General styling for the form */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            flex-direction: column;
            align-items: center;
        }
        .form-container {
            max-width: 600px;
            width: 100%;
            background-color: #fff;
            border: 1px solid #dadce0;
            border-top: 8px solid #673ab7;
            border-radius: 8px;
            box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .title {
            font-size: 32px;
            font-weight: bold;
            color: #202124;
            margin-bottom: 12px;
        }
        .sub {
            font-size: 12px;
            color: #202124;
            margin-bottom: 12px;
        }
        .question-block {
            background-color: #f9f9f9;
            border: 1px solid #dadce0;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .question {
            font-size: 18px;
            font-weight: bold;
            color: #202124;
            margin-bottom: 12px;
        }
        input[type="text"], input[type="email"], input[type="time"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        input[type="text"]:focus, input[type="email"]:focus, input[type="time"]:focus, select:focus {
            border-color: #673ab7;
            outline: none;
        }
        button {
            background-color: #673ab7;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #311b92;
        }

        a {
            color: #673ab7;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
  <iframe name="formTarget" style="display:none;"></iframe>
    <div class="form-container" id="contenedorForm">
         
        <div class="title">Formulario de Participación</div>
        <div class="sub">
            <h2 style="font-size: 24px; margin-bottom: 10px;">¡Hola!</h2>
            <p style="margin-bottom: 12px;">Este cuestionario forma parte de una investigación sobre memoria del Laboratorio de Sueño y Memoria (ITBA). Podes participar usando computadora, tablet o teléfono.</p>
            <ul style="margin: 12px 0; padding-left: 20px;">
                <li><strong>Requisitos:</strong> Tener entre 18 y 45 años, no consumir psicofármacos, y no tener desordenes de sueño diagnosticados.</li>
                <li><strong>Duración:</strong> El experimento se divide en tres partes. Esta primera parte lleva aproximadamente 10 minutos. La segunda parte se realiza inmediatamente, dentro de media hora, dentro de dos horas o dentro de 24 horas (dependiendo del grupo que te toque). La segunda parte te va a llevar unos 5 minutos. La parte tres se realiza 48 horas despues de la primera y también lleva aprox 10 minutos. Te vamos a ir mandando enlaces a tu mail, para que puedas ir completando cada parte en el tiempo correspondiente.</li>
                <li><strong>Más información:</strong> Para información más detallada sobre el experimento, podes entrar <a href="https://docs.google.com/document/d/19rrrXTJehi-1rZkxOGua4qccrDwTZhxRxt0SKN-o3cw/edit?usp=sharing" target="_blank">aquí</a>.</li>
            </ul>
            <p style="margin-bottom: 12px;">Este Protocolo fue aprobado por el Comité de Ética Humana (CEH), de la Facultad de Medicina UBA.</p>
            <p style="margin-bottom: 12px;">Para consultas comunicate con el Licenciado Facundo Urreta, al mail: furreta@itba.edu.ar,
              o la Doctora Cecilia Forcato, al mail: cforcato@itba.edu.ar</p>
       
              <p style="margin-bottom: 12px;"> La información recolectada durante este estudio será guardada confidencialmente dentro de lo que estipula la ley 25326 de protección de datos personales. Los resultados pueden ser publicados para propósitos científicos, pero la identidad de las personas participantes no será  revelada.</p>
        </div>
    

        <form id="mainForm" action="" method="POST" target="formTarget">

            <div class="question-block">
                <label class="question" for="email">Dirección de correo electrónico</label>
                <input type="email" id="email" name="entry.1190073540" placeholder="Ingresa tu correo electrónico" required>
            </div>

            <div class="question-block">
                <label class="question">¿Desde qué dispositivo estás realizando esta tarea?</label>
                <select name="entry.2120654582" required>
                    <option value="" disabled selected>Selecciona una opción</option>
                    <option value="Computadora">Computadora</option>
                    <option value="Telefono">Teléfono</option>
                    <option value="Tablet">Tablet</option>
                </select>
            </div>

            <div class="question-block">
                <label class="question">¿Das tu consentimiento para participar?</label>
                <select name="entry.402678851" required>
                    <option value="" disabled selected>Selecciona una opción</option>
                    <option value="SI">Sí</option>
                    <option value="NO">No</option>
                </select>
            </div>

            <div class="question-block">
                <label class="question" for="nombre">Nombre y apellido</label>
                <input type="text" id="nombre" name="entry.543210643" placeholder="Ingresa tu nombre completo" required>
            </div>

            <div class="question-block">
                <label class="question" for="edad">Edad</label>
                <input type="number" id="edad" name="entry.165872651" placeholder="Ingresa tu edad" required>
            </div>

            <div class="question-block">
                <label class="question">Género</label>
                <select name="entry.843997443" required>
                    <option value="" disabled selected>Selecciona tu género</option>
                    <option value="Femenino">Femenino</option>
                    <option value="Masculino">Masculino</option>
                    <option value="Otro">Otro</option>
                </select>
            </div>

            <div class="question-block">
                <label class="question">¿Cuál es tu nivel educativo actual?</label>
                <select name="entry.2121646283" required>
                    <option value="" disabled selected>Selecciona tu nivel educativo</option>
                    <option value="Posgrado completo">Posgrado completo</option>
                    <option value="Secundario completo">Secundario completo</option>
                    <option value="Secundario incompleto">Secundario incompleto</option>
                    <option value="Universitario completo">Universitario completo</option>
                    <option value="Posgrado incompleto">Posgrado incompleto</option>
                    <option value="Universitario incompleto">Universitario incompleto</option>
                    <option value="Terciario incompleto">Terciario incompleto</option>
                    <option value="Terciario completo">Terciario completo</option>
                </select>
            </div>

            <div class="question-block">
                <label class="question">¿A qué hora te despertaste hoy?</label>
                <input type="time" name="entry.810565752" required>
            </div>

            <div class="question-block">
                <label class="question">¿Consumes alguna medicación de forma crónica?</label>
                <select name="entry.221114551" id="medicacion_cronica" required>
                    <option value="" disabled selected>Selecciona una opción</option>
                    <option value="Si">Sí</option>
                    <option value="No">No</option>
                </select>
            </div>

            <div class="question-block" id="detalle_medicacion_block" style="display: none;">
                <label class="question">En caso de que consumas medicación de forma crónica, ¿Cuál/es?</label>
                <input type="text" name="entry.315741378" placeholder="Especifica la medicación">
            </div>

            <div class="question-block">
                <label class="question">¿Sufres algún trastorno o desorden del sueño?</label>
                <select name="entry.1140039148" id="trastorno_sueno" required>
                    <option value="" disabled selected>Selecciona una opción</option>
                    <option value="Si">Sí</option>
                    <option value="No">No</option>
                </select>
            </div>

            <div class="question-block" id="detalle_trastorno_block" style="display: none;">
                <label class="question">Si respondiste "Sí" en la pregunta anterior, ¿Cuál es el trastorno o desorden?</label>
                <input type="text" name="entry.830809876" placeholder="Describe el trastorno">
            </div>

            <div class="question-block">
                <label class="question">¿Participaste en otro experimento de memoria anteriormente?</label>
                <select name="entry.1546566797" id="experimento_anterior" required>
                    <option value="" disabled selected>Selecciona una opción</option>
                    <option value="Si">Sí</option>
                    <option value="No">No</option>
                </select>
            </div>

            <div class="question-block" id="detalle_experimento_block" style="display: none;">
                <label class="question">Si respondiste "Sí" a la pregunta anterior, contanos de qué se trataba el experimento</label>
                <input type="text" name="entry.1966342366" placeholder="Describe el experimento">
            </div>

            <button type="button" onclick="showInstructions()">Seguir</button>

        </form>

        <iframe name="hidden_iframe" style="display:none;"></iframe>
    </div>

    <script>
let grupoAleatorio = Math.floor(Math.random() * 4) + 1;
let horasEspera = (grupoAleatorio === 1) ? 0.0005 : (grupoAleatorio === 2) ? 0.5 : (grupoAleatorio === 3) ? 2 : 24;
// Select the form element
const form = document.getElementById("mainForm");

// Assign the action URL based on the formOption value
switch (grupoAleatorio) {
  case 1:
    form.action = "https://docs.google.com/forms/d/e/1FAIpQLSea8DuymVGIJkCHowl6AdBsixKDpiBty7pS98X_33xQtsiY4w/formResponse";
    break;
  case 2:
    form.action = "https://docs.google.com/forms/d/e/1FAIpQLSfb75iQZ0YKzrMbX0-nRsMuh2MzeG8XMJ1ahBjbUaKifu947w/formResponse";
    break;
  case 3:
    form.action = "https://docs.google.com/forms/d/e/1FAIpQLScEX8Sz6sNEKRXMZ1EVLhFBftakmSW-lhAjendzvSpF_E8awQ/formResponse";
    break;
  case 4:
    form.action = "https://docs.google.com/forms/d/e/1FAIpQLScrDEljcZ7ukYn-rATFsdjFwCmSVhXg0hKCqGbb1tDJLS2sVw/formResponse";
    break;
  default:
    console.error("Invalid form option");
}



console.log(horasEspera);

    function showInstructions() {
        // Call the validation function
        if (validateForm()) {
            // Hide the form and display the instructions only if validation passes
            document.getElementById('instrucciones').style.display = 'block';
            document.getElementById('mainForm').style.display = 'none';
            document.getElementById('contenedorForm').style.display = 'none';
        } else {
            alert('Por favor, completa todos los campos obligatorios antes de continuar.');
        }
    }

    function validateForm() {
        // Select all required fields
        const requiredFields = document.querySelectorAll('#mainForm [required]');
        let allFilled = true;

        // Check each required field
        requiredFields.forEach(field => {
            if (!field.value) {
                allFilled = false;
                // Highlight empty fields (optional)
                field.style.borderColor = 'red';
            } else {
                // Reset the border color if filled
                field.style.borderColor = '#dadce0';
            }
          
        });

 
        

        return allFilled;
    }
        
    // Event listeners for conditional fields
    document.getElementById('medicacion_cronica').addEventListener('change', function() {
        var detalleMedicacion = document.getElementById('detalle_medicacion_block');
        detalleMedicacion.style.display = this.value === 'Si' ? 'block' : 'none';
    });

    document.getElementById('trastorno_sueno').addEventListener('change', function() {
        var detalleTrastorno = document.getElementById('detalle_trastorno_block');
        detalleTrastorno.style.display = this.value === 'Si' ? 'block' : 'none';
    });

    document.getElementById('experimento_anterior').addEventListener('change', function() {
        var detalleExperimento = document.getElementById('detalle_experimento_block');
        detalleExperimento.style.display = this.value === 'Si' ? 'block' : 'none';
    });
    </script>


<div id="denuevo" style="display: none;" class="form-container">
  <p class="question-block">
  Solo se puede participar una vez en esta tarea, y el video no puede verse de nuevo.
   Si desea participar de otro de nuestros experimentos o tiene consultas,
  puede dirigirse a la pagina del Laboratorio de sueño y memoria, haciendo click en el siguiente
  enlace:
  <br>
  <br>
  <a href="https://zaap.bio/labsuenoymemoria"> Pagina del laboratorio</a>
</p>
</div>


  <div id="countdown" style="display: none; font-size: 20px; white-space: pre-wrap;"> 
    </div>
    <div id="instrucciones" style="display:none;">
    <center>
      

      <div id="instrucciones">
        <p>¡Gracias por responder!</p>
        <p>A continuación, deberá observar un video con sonido que durará aproximadamente un minuto y medio.</p>
    
        <ol style="text-align: left;">
            <li>Recomendamos que utilice auriculares y pruebe que el sonido funcione correctamente antes de comenzar.</li>
            <li>El video solo puede verse una vez; no debe pausarse, retrocederse ni alterarse de ninguna forma.</li>
            <li>Una vez que presione el botón “reproducir,” el video puede tardar algunos segundos en comenzar, dependiendo de su conexión a internet.</li>
            <li>No abandone la pestaña al concluir el video, ya que algunos segundos después se le dara información para continuar con el experimento.</li>
        </ol>
    
        <p>Por favor, antes de ver el video, compruebe que su audio funciona correctamente presionando el siguiente botón.</p>
        <p>Debería escuchar el sonido de una campana durante 10 segundos.</p>
        
        <button onclick="playAud()" type="button" id="botonaudio">Probar sonido</button>
    
        <p>Si el audio funcionó correctamente, presione el botón de abajo para pasar al video:</p>
        
        <button onclick="presentarvideo()" type="button" id="botonseguir">Pasar al video</button>
    </div>
    

        <audio id="audio">
          <source  src="prueba.mp3" type="audio/mpeg"  >
          Tu navegador no soporta la reproducción de audio.
        </audio>
        <script>
          var aud = document.getElementById("audio");
          function playAud() { 
            aud.play() }


        </script>
  </div>
 <div id>       
  </center>
    <center>
      <div id="dada" style="display: none;">
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div id="a">
        <p id="continuationLink" style="display: none;" ></p>

      </div>
    
    </div>
      
      <video id="myVideo" width="70%" height="70%" style="display: none;">
        <source src="video.mp4" type="video/mp4" />

        Your browser does not support HTML5 video.
      </video>
    </center>
</div>


<script>

if (localStorage.getItem("Link") !== null) {
    console.log("La variable 'Link' existe en el local storage.");

    
      document.getElementById('dada').style.display = 'block';
      document.getElementById('continuationLink').style.display = 'block';
      // mostrar el enlace al cuestionario aquí
}

   // Define el enlace de continuación según el grupo
   let continuationLink;
   let continuacion1= "https://docs.google.com/forms/d/e/1FAIpQLSegJ6b_Oo-Xbu3ItukjYFgftdsIB2xXabWENVzoduNJnbry8Q/viewform?usp=sf_link"
   let continuacion2="https://docs.google.com/forms/d/e/1FAIpQLScZRROV95DD7gc0Kaa7BH37Cg1XXvpAaXHcnktDE1at5gzO7Q/viewform?usp=sf_link"
   let continuacion3="https://docs.google.com/forms/d/e/1FAIpQLSdOq4dzUhshVgBzk7EhgOeokkiz-0bJjHjdn1DB7Wit584iuw/viewform?usp=sf_link"
   let continuacion4="https://docs.google.com/forms/d/e/1FAIpQLSdS-0YCQVv6inDa_DMh9yY_sJAbYSwud7CTxdqZ9qPaTCsOjQ/viewform?usp=sf_link"




       if (localStorage.getItem("visita")) {
        if (localStorage.getItem("visita")=="realizada") {

          document.getElementById("denuevo").style.display = "block";
          


        }
        document.getElementById("instrucciones").style.display = "none";
        document.getElementById("contenedorForm").style.display = "none";
        
        
      }

      var vid = document.getElementById("myVideo");
      function presentarvideo () {
        var aud = document.getElementById("audio");
    
            aud.pause(); 

      if (localStorage.getItem("visita")=="realizada") {
        alert("Este video solo puede verse una vez");
        
      } else {
        localStorage.setItem("timeGroup",horasEspera);
        document.getElementById("instrucciones").style.display = "none";
        document.getElementById("myVideo").style.display = "block";
        document.getElementById("boton").style.display = "block";
        document.addEventListener("contextmenu", (event) =>
          event.preventDefault()
        );
       
        
      } }


        
      function rotateVideo() {
    const video = document.getElementById("myVideo");

    // Ensure the video element exists before applying transformations
    if (video) {
        // Apply 90-degree rotation using CSS
        video.style.transform = "rotate(90deg)";
        
        // Set the transform origin to center the rotation within the container
        video.style.transformOrigin = "center center";
        
        // Use viewport units to make it responsive
        video.style.width = "100vh"; // Set width to 100% of the viewport height
        video.style.height = "100vw"; // Set height to 100% of the viewport width
        
        // Ensure the container allows overflow if necessary
        video.parentElement.style.overflow = "hidden";

        // Position the video and add margin to the left
        video.style.position = "absolute"; // Allow positioning within the container
        video.style.top = "50%"; // Center vertically
        video.style.left = "calc(50% + 20px)"; // Center horizontally and add 20px margin
        video.style.transform = "translate(-50%, -50%) rotate(90deg)"; // Adjust transform to include centering
    }
}



function esDispositivoMovil() {
  return /Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(navigator.userAgent);
}

// Uso de la función
if (esDispositivoMovil()) {
  console.log("Estás visitando la página desde un dispositivo móvil.");
} else {
  console.log("Estás visitando la página desde un dispositivo de escritorio.");
}

 


    

        function playVid() {
         
            vid.play();
            
if(esDispositivoMovil()){
  rotateVideo();

}
   

            localStorage.setItem("visita", "realizada");
            document.getElementById("boton").style.display = "none";

            document.getElementById("myVideo").addEventListener("ended", myHandler, false);
          

          
          }
          
if (localStorage.getItem("visita")=="2") {
  contador();
        
      }

function myHandler(e) {
  document.getElementById('myVideo').style.display = 'none';
  
  localStorage.setItem("visita", "2");
  contador();
 
}


function startCountdown(storedEndTime) {
console.log(storedEndTime);
  if (storedEndTime=="no") {
  const twoHours = horasEspera * 60 * 60 * 1000; // dos horas en milisegundos
  const endTime = Date.now() + twoHours; // tiempo de finalización en milisegundos
  console.log(endTime);
  const countdownElement = document.getElementById("countdown");
  setInterval(intervalId(endTime),1000);
}
else{
  const endTime =storedEndTime;
  const countdownElement = document.getElementById("countdown");
  setInterval(intervalId(endTime),1000);
}

  

  function intervalId (endTime)  {
    setInterval(() => {

    
    const countdownElement = document.getElementById("countdown");
    console.log(endTime);
    const remainingTime = endTime - Date.now(); // tiempo restante en milisegundos

    if (remainingTime <= 0) {
      clearInterval(intervalId);
      countdownElement.textContent = "¡Listo!";
      //localStorage.removeItem("countdownEndTime");



      switch (grupoAleatorio) {
            case 1:
                continuationLink = continuacion1;
                break;
            case 2:
                continuationLink = continuacion2;
                break;
            case 3:
                continuationLink = continuacion3;
                break;
            case 4:
                continuationLink = continuacion4;
                break;
            default:
                continuationLink = "#";
        }

        localStorage.setItem("Link",continuationLink);
        



      
      document.getElementById('continuationLink').innerHTML = `Para continuar con el experimento, haz clic en el siguiente enlace. Simultaneamente, este enlace sera enviado a tu correo electronico : <a href="${continuationLink}" target="_blank">Continuar</a>`;
      document.getElementById('dada').style.display = 'block';
      document.getElementById('continuationLink').style.display = 'block';
      // mostrar el enlace al cuestionario aquí
    } else {
      const remainingHours = Math.floor(remainingTime / (60*60*1000));
      const remainingMinutes = Math.floor((remainingTime / ( 60 *1000))-60*remainingHours);
      const remainingSeconds = Math.floor((remainingTime % (60 * 1000)) / 1000);
      
      countdownElement.style.display = "block";
      countdownElement.style.textAlign= "center";


      document.getElementById('dada').style.display = 'none'; 
      countdownElement.textContent = `

      El enlace para la siguiente parte se te enviara por mail luego de transcurridas ${localStorage.getItem("timeGroup")} hs.
      
      Por favor, intentá realizar la tarea inmediatamente despues de obtener el enlace. 
      
      
      Tiempo restante:${remainingHours}: ${remainingMinutes}:${remainingSeconds.toString().padStart(2, "0")}`;
      localStorage.setItem("countdownEndTime", endTime);
      

    }
  
  }, 1000);
  
  
  }
  

}

function contador() {
  const storedEndTime = localStorage.getItem("countdownEndTime");
  
  const Link = localStorage.getItem("Link");
  console.log(Link);
  document.getElementById('continuationLink').innerHTML = `Para continuar con el experimento, haz clic en el siguiente enlace. Simultaneamente, este enlace sera enviado a tu correo electronico: <a href="${Link}" target="_blank">Continuar</a>`;
  document.getElementById('dada').style.display = 'block';
  
  if (storedEndTime) {
    const remainingTime = storedEndTime - Date.now();
    if (remainingTime <= 0) {
      document.getElementById('dada').style.display = 'block';
      // mostrar el enlace al cuestionario aquí
    } else {
      console.log(storedEndTime);
      startCountdown(storedEndTime);
      
    }
  } else {
    const storedEndTime="no";
    console.log(storedEndTime);
    startCountdown(storedEndTime);
    sendAnswers();

              
  }
};
        


function sendAnswers(){
  const mainForm = document.getElementById('mainForm');
            
            mainForm.submit();

}



    </script>
    <center>
      <button onclick="playVid()" type="button" id="boton" style="display: none;">Reproducir</button>
      
    </center>
    <script>
      if (localStorage.getItem("visita")) {
        document.getElementById("boton").style.display = "none";
      }








    </script>
</body>
</html>

